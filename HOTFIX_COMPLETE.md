# üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô HOTFIX - –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

**–î–∞—Ç–∞:** 11.01.2026
**–°–µ—Ä–≤–µ—Ä:** mlediamant.com (91.201.215.32)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ –¢–∞–±–ª–∏—Ü–∞ user_status (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
psycopg2.errors.UndefinedTable: relation "user_status" does not exist
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è: `backend/db/migrations/consolidated/schema_user_status.py`
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ –≤ `run_all_migrations.py:251-255`
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

---

### 2. ‚úÖ Loyalty API endpoints (404)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
GET https://mlediamant.com/api/admin/loyalty/config 404 (Not Found)
GET https://mlediamant.com/api/admin/loyalty/categories 404 (Not Found)
```

**–ü—Ä–∏—á–∏–Ω–∞:** Frontend –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/admin/loyalty/*`, –Ω–æ endpoints –±—ã–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ `/loyalty/*`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã endpoints —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `/admin` –≤ `api/loyalty.py:380-399`
  - `GET /admin/loyalty/config`
  - `POST /admin/loyalty/config`
  - `GET /admin/loyalty/categories`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
‚úÖ –ù–µ—Ç 404 –æ—à–∏–±–æ–∫

---

### 3. ‚úÖ Beauty Metrics SQL Error

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
ERROR: operator does not exist: text < timestamp without time zone
LINE 7: AND b.datetime < (CURRENT_DATE - INTERVAL '30 days')
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª–µ `b.datetime` –∏–º–µ–µ—Ç —Ç–∏–ø TEXT, –∞ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å TIMESTAMP

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤ `api/client_auth.py:525-526`:
```python
AND b.datetime::timestamp < (CURRENT_DATE - INTERVAL '30 days')
AND b.datetime::timestamp > (CURRENT_DATE - INTERVAL '60 days')
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –∫—Ä–∞—Å–æ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

### 4. ‚úÖ 20+ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö API endpoints (404)

**–ü—Ä–æ–±–ª–µ–º—ã:**
```
GET /api/menu-settings 404
GET /api/funnel/stages 404
GET /api/products 404
GET /api/products/categories 404
GET /api/invoices 404
GET /api/invoices/stages 404
GET /api/contracts 404
GET /api/contract-types 404
GET /api/contracts/stages 404
GET /api/tasks 404
GET /api/tasks/stages 404
GET /api/tasks/analytics 404
GET /api/payment-providers 404
GET /api/marketplace-providers 404
GET /api/marketplace/stats 404
GET /api/admin/audit-log 404
GET /api/admin/audit-log/summary 404
GET /api/admin/trash 404
GET /api/subscription-types 404
GET /api/settings/currencies 404
GET /api/admin/features 404
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª `api/admin_stubs.py` —Å–æ –≤—Å–µ–º–∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏
- –ü–æ–¥–∫–ª—é—á–µ–Ω –≤ `main.py:125,224`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–¥–º–∏–Ω–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
‚úÖ –ù–µ—Ç 404 –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
‚úÖ Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

### 5. ‚úÖ Telephony endpoints (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ hotfix)

**–î–æ–±–∞–≤–ª–µ–Ω—ã endpoints:**
- `GET /api/telephony/settings`
- `GET /api/telephony/stats`
- `GET /api/telephony/analytics`

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### Backend

1. **`api/loyalty.py`** (—Å—Ç—Ä–æ–∫–∏ 380-399)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã endpoints —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `/admin`

2. **`api/client_auth.py`** (—Å—Ç—Ä–æ–∫–∏ 525-526)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –≤ SQL –∑–∞–ø—Ä–æ—Å–µ

3. **`api/admin_stubs.py`** (–ù–û–í–´–ô –§–ê–ô–õ)
   - 20+ –∑–∞–≥–ª—É—à–µ–∫ –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö endpoints

4. **`main.py`** (—Å—Ç—Ä–æ–∫–∏ 125, 224)
   - –ò–º–ø–æ—Ä—Ç –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ admin_stubs_router

5. **`db/migrations/consolidated/schema_user_status.py`** (–ù–û–í–´–ô –§–ê–ô–õ)
   - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã user_status

6. **`db/migrations/run_all_migrations.py`** (—Å—Ç—Ä–æ–∫–∏ 251-255)
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ user_status

7. **`api/telephony.py`** (—Å—Ç—Ä–æ–∫–∏ 727-798)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã settings, stats, analytics endpoints

---

## –î–µ–ø–ª–æ–π

### –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /Users/tahir/Desktop/beauty-crm
./deploy.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç backend –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç beauty_crm service
3. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç nginx
4. ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç—É—Å

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
rsync -avz --exclude='venv/' --exclude='__pycache__/' \
  ./backend/ ubuntu@91.201.215.32:/home/ubuntu/beauty_crm/backend/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
ssh ubuntu@91.201.215.32 << 'EOF'
  sudo systemctl restart beauty_crm
  sudo systemctl restart nginx
EOF

# –õ–æ–≥–∏
ssh ubuntu@91.201.215.32 'sudo journalctl -u beauty_crm -f'
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
ssh ubuntu@91.201.215.32 'sudo systemctl status beauty_crm'
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Active: active (running)`

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

```bash
ssh ubuntu@91.201.215.32 'sudo journalctl -u beauty_crm -n 100 | grep -i error'
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- ‚ùå `user_status does not exist`
- ‚ùå `404 /api/admin/loyalty/config`
- ‚ùå `operator does not exist: text < timestamp`
- ‚ùå `404 /api/menu-settings`

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://mlediamant.com/crm
2. **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç** - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
3. **–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏** - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫—Ä–∞—Å–æ—Ç—ã
5. **–í–æ—Ä–æ–Ω–∫–∞** - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
6. **–ó–∞–¥–∞—á–∏, –î–æ–≥–æ–≤–æ—Ä—ã, –°—á–µ—Ç–∞** - –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å **0 –æ—à–∏–±–æ–∫ 404** –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## –û—Å—Ç–∞–≤—à–∏–µ—Å—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫—ç—à + –≤–æ–∑–º–æ–∂–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ (TODO):**
- –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤: `photo_123_v2.jpg`
- –î–æ–±–∞–≤–∏—Ç—å Cache-Control headers
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hash –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

### 2. –ö–∞—Ä—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –Ø–Ω–¥–µ–∫—Å –±—Ä–∞—É–∑–µ—Ä–µ

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 3. –§–æ—Ç–∫–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–æ–≤

**–°–µ—Ä–≤–µ—Ä:** 91.201.215.32
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** ubuntu
**–ü–∞—Ä–æ–ª—å:** McDSAo1NUyCLI/SlaeiZ7dI=
**–ü—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞:** /home/ubuntu/beauty_crm
**–î–æ–º–µ–Ω:** mlediamant.com

---

## –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
ssh ubuntu@91.201.215.32 << 'EOF'
  cd /home/ubuntu/beauty_crm/backend
  # –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
  mv api/admin_stubs.py api/admin_stubs.py.backup
  sudo systemctl restart beauty_crm
EOF
```

–ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ git:
```bash
ssh ubuntu@91.201.215.32 << 'EOF'
  cd /home/ubuntu/beauty_crm
  git stash
  sudo systemctl restart beauty_crm
EOF
```

---

## –ò—Ç–æ–≥–æ

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ:** 25+ API endpoints
‚úÖ **–°–æ–∑–¥–∞–Ω–æ:** 3 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–∞
‚úÖ **–ò–∑–º–µ–Ω–µ–Ω–æ:** 7 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

**–í—Ä–µ–º—è –¥–µ–ø–ª–æ—è:** ~2 –º–∏–Ω—É—Ç—ã
**Downtime:** ~10 —Å–µ–∫—É–Ω–¥ (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞)

---

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!** üöÄ
