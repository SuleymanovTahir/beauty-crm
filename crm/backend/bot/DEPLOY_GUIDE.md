# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é Beauty CRM

## –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç

```bash
cd /Users/tahir/Desktop/beauty-crm/crm
./deploy.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã backend –∏ frontend –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç beauty_crm service
3. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç nginx
4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π (–ø–æ—à–∞–≥–æ–≤–æ)

#### –®–∞–≥ 1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è backend

```bash
rsync -avz --progress \
    --exclude='venv/' \
    --exclude='__pycache__/' \
    --exclude='*.pyc' \
    ./backend/ ubuntu@32.235:/home/ubuntu/beauty_crm/crm/backend/
```

#### –®–∞–≥ 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è frontend

```bash
rsync -avz --progress \
    --exclude='node_modules/' \
    --exclude='dist/' \
    ./frontend/ ubuntu@32.235:/home/ubuntu/beauty_crm/crm/frontend/
```

#### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
ssh ubuntu@32.235
sudo systemctl daemon-reload
sudo systemctl restart beauty_crm
sudo systemctl restart nginx
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
ssh ubuntu@32.235 'sudo journalctl -u beauty_crm -f'
```

–ò–ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

```bash
./deploy.sh && ssh ubuntu@32.235 'sudo journalctl -u beauty_crm -f'
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞

```bash
ssh ubuntu@32.235 'sudo systemctl status beauty_crm'
```

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏

```bash
ssh ubuntu@32.235 'sudo journalctl -u beauty_crm -n 50 --no-pager'
```

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —ç—Ç–æ–º –¥–µ–ø–ª–æ–µ

### 1. –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–µ–π (Recordings)

- ‚úÖ Backend API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω ([backend/api/recordings.py](backend/api/recordings.py))
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ([backend/db/init.py](backend/db/init.py))
- ‚úÖ 9 –Ω–æ–≤—ã—Ö frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ `frontend/src/components/recordings/`
- ‚úÖ –í–∫–ª–∞–¥–∫–∞ "–ó–∞–ø–∏—Å–∏" –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏
- ‚úÖ –ú–µ–Ω—é —Ç—Ä–æ–µ—Ç–æ—á–∏—è –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —á–∞—Ç–µ

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã

- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ [backend/tests/test_utils.py](backend/tests/test_utils.py)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã duplicate key errors –≤ —Ç–µ—Å—Ç–∞—Ö:
  - `test_detailed.py`
  - `test_new_features.py`
  - `test_schedule.py`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –≤—ã—Ö–æ–¥–Ω—ã–µ, –ø–µ—Ä–µ—Ä—ã–≤—ã)

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã

- ‚úÖ [backend/main.py:512](backend/main.py#L512) - `diagnostic_full` –∏–º–ø–æ—Ä—Ç
- ‚úÖ [backend/main.py:41](backend/main.py#L41) - `middleware` –∏–º–ø–æ—Ä—Ç

### 4. –ú–∏–≥—Ä–∞—Ü–∏–∏

- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ ([backend/main.py:598](backend/main.py#L598))

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
ssh ubuntu@32.235 'sudo systemctl status beauty_crm'
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Active: active (running)`

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–∞–¥–∞—Ç—å —Å –æ—à–∏–±–∫–∞–º–∏ duplicate key:

```bash
ssh ubuntu@32.235 'cd /home/ubuntu/beauty_crm/crm/backend && python3 tests/test_new_features.py'
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∑–∞–ø–∏—Å–µ–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://your-domain.com/admin/telephony`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ó–∞–ø–∏—Å–∏"
3. –î–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–ø–∫–∞–º–∏

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç
2. –°–ø—Ä–∞–≤–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–Ω–æ–ø–∫–∞ —Å —Ç—Ä–æ–µ—Ç–æ—á–∏–µ–º
3. –ù–∞–∂–º–∏—Ç–µ - –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –º–µ–Ω—é —Å —Ç—Ä–µ–º—è –æ–ø—Ü–∏—è–º–∏

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç

```bash
ssh ubuntu@32.235
cd /home/ubuntu/beauty_crm
git stash  # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main  # –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
sudo systemctl restart beauty_crm
```

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–∑–≤–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ `main.py`:

```python
# –°—Ç—Ä–æ–∫–∞ 598
# run_all_migrations()  # –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å
```

–ó–∞—Ç–µ–º:

```bash
sudo systemctl restart beauty_crm
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è

```
beauty_crm/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                           # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω run_all_migrations()
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ recordings.py                 # –ù–æ–≤—ã–π API –¥–ª—è –∑–∞–ø–∏—Å–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/consolidated/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ schema_recording_folders.py  # –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ tests/
‚îÇ       ‚îú‚îÄ‚îÄ test_utils.py                 # –ù–æ–≤–∞—è —É—Ç–∏–ª–∏—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ test_detailed.py              # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω
‚îÇ       ‚îú‚îÄ‚îÄ test_new_features.py          # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω
‚îÇ       ‚îî‚îÄ‚îÄ test_schedule.py              # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω
‚îî‚îÄ‚îÄ frontend/
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ components/
        ‚îÇ   ‚îú‚îÄ‚îÄ recordings/               # 9 –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        ‚îÇ   ‚îî‚îÄ‚îÄ shared/
        ‚îÇ       ‚îî‚îÄ‚îÄ InternalChatWithWebRTC.tsx  # –î–æ–±–∞–≤–ª–µ–Ω–æ –º–µ–Ω—é
        ‚îú‚îÄ‚îÄ pages/admin/
        ‚îÇ   ‚îî‚îÄ‚îÄ Telephony.tsx             # –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∞
        ‚îî‚îÄ‚îÄ locales/ru/admin/
            ‚îî‚îÄ‚îÄ telephony.json            # 39 –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
ssh ubuntu@32.235 'sudo journalctl -u beauty_crm -f'
```

–°–ª–µ–¥–∏—Ç–µ –∑–∞:

- ‚ùå –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ (`ModuleNotFoundError`)
- ‚ùå –û—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π (`duplicate key`, `table already exists`)
- ‚ùå –û—à–∏–±–∫–∏ —Ç–µ—Å—Ç–æ–≤ (–µ—Å–ª–∏ –æ–Ω–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫: `Application startup complete`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

```bash
ssh ubuntu@32.235 'free -h && ps aux | grep gunicorn | head -5'
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞

```bash
ssh ubuntu@32.235 'sudo systemctl cat beauty_crm'
```

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

```bash
ssh ubuntu@32.235 'sudo systemctl reload beauty_crm'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
ssh ubuntu@32.235 'sudo nginx -t'
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u beauty_crm -n 100`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `sudo systemctl status beauty_crm`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: `RECORDINGS_SETUP.md`, `TESTS_FIXED.md`

---

**–°–æ–∑–¥–∞–Ω–æ:** 11.01.2026
**–í–µ—Ä—Å–∏—è:** 1.0
**–ê–≤—Ç–æ—Ä:** Claude Code Assistant
