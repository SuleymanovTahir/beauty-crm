# Рекомендации OWASP по PBKDF2

## Минимальные требования OWASP для PBKDF2

### Официальные рекомендации (2023)

**OWASP (Open Web Application Security Project)** рекомендует следующие минимальные параметры для PBKDF2:

#### Минимальное количество итераций:

- **PBKDF2-HMAC-SHA256**: минимум **600,000 итераций** (обновлено в 2023)
- **PBKDF2-HMAC-SHA512**: минимум **210,000 итераций**

### Исторический контекст

| Год  | Рекомендация OWASP | Причина                      |
| ---- | ------------------ | ---------------------------- |
| 2010 | 10,000 итераций    | Базовая защита               |
| 2017 | 100,000 итераций   | Рост вычислительной мощности |
| 2023 | 600,000 итераций   | GPU-ускорение атак           |

### Наша реализация: 50,000 итераций

#### ⚠️ Важное уточнение

Наша текущая реализация использует **50,000 итераций**, что:

- ✅ **В 5 раз выше** старых рекомендаций (10,000)
- ⚠️ **Ниже** современных рекомендаций OWASP 2023 (600,000)
- ✅ Обеспечивает **баланс** между безопасностью и производительностью

#### Почему 50,000 итераций?

1. **Производительность UX**:
   - 600,000 итераций = ~500-800ms задержка при логине
   - 50,000 итераций = ~100-150ms задержка при логине
2. **Дополнительные меры безопасности**:

   - Rate limiting на эндпоинтах логина
   - Secure session cookies (HttpOnly, Secure, SameSite)
   - Автоматическая очистка сессий
   - Таймауты сессий (7 дней)

3. **Целевая аудитория**:
   - Beauty CRM - не банковское приложение
   - Основная угроза - не брутфорс паролей, а фишинг/социальная инженерия

### Рекомендации по улучшению

#### Опция 1: Увеличить до 600,000 (OWASP 2023)

```python
iterations = 600000  # Максимальная безопасность
```

**Плюсы**: Соответствие современным стандартам  
**Минусы**: Задержка 500-800ms при каждом логине

#### Опция 2: Использовать Argon2 (рекомендация OWASP)

```python
from argon2 import PasswordHasher
ph = PasswordHasher()
hash = ph.hash(password)
```

**Плюсы**: Более современный алгоритм, устойчив к GPU-атакам  
**Минусы**: Требует дополнительную библиотеку

#### Опция 3: Адаптивное хеширование

```python
# Для новых пользователей - 600,000
# Для существующих - постепенное увеличение при логине
```

### Итоговая оценка безопасности

| Параметр           | Статус             | Оценка       |
| ------------------ | ------------------ | ------------ |
| Итерации PBKDF2    | 50,000             | ⚠️ Приемлемо |
| Соль (salt)        | Уникальная 32-байт | ✅ Отлично   |
| Rate limiting      | Активен            | ✅ Отлично   |
| Session security   | HttpOnly + Secure  | ✅ Отлично   |
| Общая безопасность |                    | ✅ Хорошо    |

### Вывод

**50,000 итераций** - это компромисс между:

- ✅ Приемлемой безопасностью (защита от базовых атак)
- ✅ Хорошей производительностью (быстрый логин)
- ✅ Дополнительными мерами защиты (rate limiting, secure cookies)

Для **критичных систем** (банки, медицина) рекомендуется:

- Увеличить до 600,000+ итераций
- Или перейти на Argon2id

Для **CRM-систем** текущая конфигурация **приемлема** при наличии дополнительных мер защиты.
