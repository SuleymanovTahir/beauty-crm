#!/usr/bin/env python3
"""
Final comprehensive fix for all service translations.
This script will be integrated into run_all_migrations().
"""

import sys
from pathlib import Path

backend_dir = Path(__file__).parent.parent.parent
sys.path.insert(0, str(backend_dir))

from db.connection import get_db_connection

# Complete mapping: English name ‚Üí (Russian name, Russian description)
SERVICE_TRANSLATIONS = {
    # === NAILS ===
    'acrylic extension': ('–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –∞–∫—Ä–∏–ª–æ–º', '–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π –∞–∫—Ä–∏–ª–æ–º'),
    'acrylic overlay': ('–ü–æ–∫—Ä—ã—Ç–∏–µ –∞–∫—Ä–∏–ª–æ–º', '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –Ω–æ–≥—Ç–µ–π –∞–∫—Ä–∏–ª–æ–º'),
    'change gel': ('–°–º–µ–Ω–∞ –≥–µ–ª—å-–ª–∞–∫–∞', '–°–Ω—è—Ç–∏–µ –∏ –Ω–∞–Ω–µ—Å–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥–µ–ª—å-–ª–∞–∫–∞'),
    'french': ('–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä'),
    'gel extension': ('–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –≥–µ–ª–µ–º', '–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π –≥–µ–ª–µ–º'),
    'gel overlay': ('–ü–æ–∫—Ä—ã—Ç–∏–µ –≥–µ–ª–µ–º', '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –Ω–æ–≥—Ç–µ–π –≥–µ–ª–µ–º'),
    'hard gel': ('–¢–≤–µ—Ä–¥—ã–π –≥–µ–ª—å', '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ç–≤–µ—Ä–¥—ã–º –≥–µ–ª–µ–º'),
    'nail design': ('–î–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π', '–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π'),
    'pedicure basic': ('–ë–∞–∑–æ–≤—ã–π –ø–µ–¥–∏–∫—é—Ä', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–µ–¥–∏–∫—é—Ä'),
    'pedicure classic': ('–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–µ–¥–∏–∫—é—Ä', '–ü–µ–¥–∏–∫—é—Ä —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å—Ç–æ–ø'),
    'pedicure gel': ('–ü–µ–¥–∏–∫—é—Ä —Å –≥–µ–ª—å-–ª–∞–∫–æ–º', '–ü–µ–¥–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≥–µ–ª—å-–ª–∞–∫–æ–º'),
    'podology': ('–ü–æ–¥–æ–ª–æ–≥–∏—è', '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —É—Ö–æ–¥ –∑–∞ —Å—Ç–æ–ø–∞–º–∏'),
    'remove classic': ('–°–Ω—è—Ç–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –ª–∞–∫–∞', '–°–Ω—è—Ç–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –ª–∞–∫–∞ —Å –Ω–æ–≥—Ç–µ–π'),
    'remove gel': ('–°–Ω—è—Ç–∏–µ –≥–µ–ª—å-–ª–∞–∫–∞', '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–Ω—è—Ç–∏–µ –≥–µ–ª—å-–ª–∞–∫–∞'),
    'remove nail extensions': ('–°–Ω—è—Ç–∏–µ –Ω–∞—Ä–∞—â–µ–Ω–Ω—ã—Ö –Ω–æ–≥—Ç–µ–π', '–°–Ω—è—Ç–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–æ–≥—Ç–µ–π'),
    'spa pedicure': ('–°–ü–ê-–ø–µ–¥–∏–∫—é—Ä', '–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π –°–ü–ê-–ø–µ–¥–∏–∫—é—Ä'),
    
    # === HAIR ===
    'hair cut': ('–°—Ç—Ä–∏–∂–∫–∞', '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∏–∂–∫–∞ –≤–æ–ª–æ—Å'),
    'hair wash': ('–ú—ã—Ç—å–µ –≤–æ–ª–æ—Å', '–ú—ã—Ç—å–µ –≤–æ–ª–æ—Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏'),
    'hair style': ('–£–∫–ª–∞–¥–∫–∞', '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–∫–ª–∞–¥–∫–∞ –≤–æ–ª–æ—Å'),
    'hair treatment': ('–£—Ö–æ–¥ –∑–∞ –≤–æ–ª–æ—Å–∞–º–∏', '–õ–µ—á–µ–±–Ω—ã–π —É—Ö–æ–¥ –∑–∞ –≤–æ–ª–æ—Å–∞–º–∏'),
    'hair extension (only removal)': ('–°–Ω—è—Ç–∏–µ –Ω–∞—Ä–∞—â–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å', '–°–Ω—è—Ç–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å'),
    'hair extensions (1 can)': ('–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –≤–æ–ª–æ—Å (1 –∫–∞–ø—Å—É–ª–∞)', '–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –≤–æ–ª–æ—Å –∫–∞–ø—Å—É–ª—å–Ω—ã–º –º–µ—Ç–æ–¥–æ–º'),
    'trimming without wash': ('–ü–æ–¥—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –±–µ–∑ –º—ã—Ç—å—è', '–ü–æ–¥—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—á–∏–∫–æ–≤ –±–µ–∑ –º—ã—Ç—å—è'),
    
    # === MASSAGE ===
    'anti-cellulite massage': ('–ê–Ω—Ç–∏—Ü–µ–ª–ª—é–ª–∏—Ç–Ω—ã–π –º–∞—Å—Å–∞–∂', '–ú–∞—Å—Å–∞–∂ –ø—Ä–æ—Ç–∏–≤ —Ü–µ–ª–ª—é–ª–∏—Ç–∞'),
    'back 30 min': ('–ú–∞—Å—Å–∞–∂ —Å–ø–∏–Ω—ã 30 –º–∏–Ω', '–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π –º–∞—Å—Å–∞–∂ —Å–ø–∏–Ω—ã'),
    'back massage (5-10)': ('–ú–∞—Å—Å–∞–∂ —Å–ø–∏–Ω—ã (–∫—É—Ä—Å)', '–ö—É—Ä—Å –º–∞—Å—Å–∞–∂–∞ —Å–ø–∏–Ω—ã 5-10 —Å–µ–∞–Ω—Å–æ–≤'),
    'classic general massage': ('–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–∞—Å—Å–∞–∂', '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –æ–±—â–∏–π –º–∞—Å—Å–∞–∂ —Ç–µ–ª–∞'),
    'full body 60 min': ('–ú–∞—Å—Å–∞–∂ –≤—Å–µ–≥–æ —Ç–µ–ª–∞', '–ú–∞—Å—Å–∞–∂ –≤—Å–µ–≥–æ —Ç–µ–ª–∞ 60 –º–∏–Ω—É—Ç'),
    'head 40 min': ('–ú–∞—Å—Å–∞–∂ –≥–æ–ª–æ–≤—ã', '–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π –º–∞—Å—Å–∞–∂ –≥–æ–ª–æ–≤—ã'),
    'hotstone': ('–ú–∞—Å—Å–∞–∂ –≥–æ—Ä—è—á–∏–º–∏ –∫–∞–º–Ω—è–º–∏', '–°—Ç–æ—É–Ω-—Ç–µ—Ä–∞–ø–∏—è –≥–æ—Ä—è—á–∏–º–∏ –∫–∞–º–Ω—è–º–∏'),
    'leg/feet/ hand 40 min': ('–ú–∞—Å—Å–∞–∂ –Ω–æ–≥/—Ä—É–∫', '–ú–∞—Å—Å–∞–∂ –Ω–æ–≥, —Å—Ç–æ–ø –∏ —Ä—É–∫'),
    'moroccan bath loofa': ('–ú–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∞—è –±–∞–Ω—è —Å –ª—é—Ñ–æ–π', '–ú–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∞—è –±–∞–Ω—è —Å –ø–∏–ª–∏–Ω–≥–æ–º –ª—é—Ñ–æ–π'),
    'moroccan bathhouse': ('–ú–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∞—è –±–∞–Ω—è', '–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ä–æ–∫–∫–∞–Ω—Å–∫–∞—è –±–∞–Ω—è'),
    'neck & shoulder 30 min': ('–ú–∞—Å—Å–∞–∂ —à–µ–∏ –∏ –ø–ª–µ—á', '–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π –º–∞—Å—Å–∞–∂ —à–µ–∏ –∏ –ø–ª–µ—á'),
    'sculpture body massage': ('–°–∫—É–ª—å–ø—Ç—É—Ä–Ω—ã–π –º–∞—Å—Å–∞–∂', '–ú–æ–¥–µ–ª–∏—Ä—É—é—â–∏–π –º–∞—Å—Å–∞–∂ —Ç–µ–ª–∞'),
    
    # === PROMO ===
    'blow dry packages 5': ('–ü–∞–∫–µ—Ç —É–∫–ª–∞–¥–æ–∫ (5 —à—Ç)', '–ü–∞–∫–µ—Ç –∏–∑ 5 —É–∫–ª–∞–¥–æ–∫'),
    'combo basic 150': ('–ö–æ–º–±–æ –±–∞–∑–æ–≤—ã–π', '–ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–ª–µ–∫—Å —É—Å–ª—É–≥'),
    'promo 390': ('–ê–∫—Ü–∏—è 390', '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ'),
    'promo mani pedi 250': ('–ê–∫—Ü–∏—è –º–∞–Ω–∏–∫—é—Ä+–ø–µ–¥–∏–∫—é—Ä', '–ú–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä –ø–æ –∞–∫—Ü–∏–∏'),
    'promotion overlay manicure': ('–ê–∫—Ü–∏–æ–Ω–Ω—ã–π –º–∞–Ω–∏–∫—é—Ä', '–ú–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –ø–æ –∞–∫—Ü–∏–∏'),
    
    # === WAXING ===
    'brazilian': ('–ë—Ä–∞–∑–∏–ª—å—Å–∫–∞—è —ç–ø–∏–ª—è—Ü–∏—è', '–ë—Ä–∞–∑–∏–ª—å—Å–∫–∞—è —ç–ø–∏–ª—è—Ü–∏—è –±–∏–∫–∏–Ω–∏'),
    'cheeks': ('–≠–ø–∏–ª—è—Ü–∏—è —â–µ–∫', '–≠–ø–∏–ª—è—Ü–∏—è –æ–±–ª–∞—Å—Ç–∏ —â–µ–∫'),
    'full body': ('–≠–ø–∏–ª—è—Ü–∏—è –≤—Å–µ–≥–æ —Ç–µ–ª–∞', '–ü–æ–ª–Ω–∞—è —ç–ø–∏–ª—è—Ü–∏—è —Ç–µ–ª–∞'),
    'under arms': ('–≠–ø–∏–ª—è—Ü–∏—è –ø–æ–¥–º—ã—à–µ–∫', '–≠–ø–∏–ª—è—Ü–∏—è –ø–æ–¥–º—ã—à–µ—á–Ω—ã—Ö –≤–ø–∞–¥–∏–Ω'),
    'upper lip': ('–≠–ø–∏–ª—è—Ü–∏—è –≤–µ—Ä—Ö–Ω–µ–π –≥—É–±—ã', '–≠–ø–∏–ª—è—Ü–∏—è –æ–±–ª–∞—Å—Ç–∏ –Ω–∞–¥ –≤–µ—Ä—Ö–Ω–µ–π –≥—É–±–æ–π'),
}

def fix_all_services_final():
    """Final comprehensive fix"""
    
    print("üîß Final comprehensive service fix...")
    
    conn = get_db_connection()
    cursor = conn.cursor()
    
    try:
        # Get all services
        cursor.execute("SELECT id, name, name_en FROM services")
        services = cursor.fetchall()
        
        print(f"\nüìã Processing {len(services)} services...")
        
        fixed_count = 0
        
        for service_id, name, name_en in services:
            # Determine English name
            en_name = (name_en or name or '').lower().strip()
            
            if en_name in SERVICE_TRANSLATIONS:
                ru_name, ru_desc = SERVICE_TRANSLATIONS[en_name]
                
                # Update service
                cursor.execute("""
                    UPDATE services
                    SET name_ru = %s,
                        name_en = %s,
                        description = %s,
                        description_ru = %s
                    WHERE id = %s
                """, (ru_name, name_en or name, ru_desc, ru_desc, service_id))
                
                print(f"   ‚úÖ {name_en or name}: {ru_name}")
                fixed_count += 1
        
        # Clear all bad translations from description fields
        print("\nüßπ Clearing bad translations...")
        cursor.execute("""
            UPDATE services
            SET description_en = NULL,
                description_ar = NULL,
                description_de = NULL,
                description_es = NULL,
                description_fr = NULL,
                description_hi = NULL,
                description_kk = NULL,
                description_pt = NULL
        """)
        
        conn.commit()
        print(f"\n‚úÖ Fixed {fixed_count} services!")
        print("üí° Run 'npm run db:i18n:auto' to regenerate translations")
        
    except Exception as e:
        conn.rollback()
        print(f"\n‚ùå Error: {e}")
        import traceback
        traceback.print_exc()
        raise
    finally:
        cursor.close()
        conn.close()

if __name__ == "__main__":
    fix_all_services_final()
