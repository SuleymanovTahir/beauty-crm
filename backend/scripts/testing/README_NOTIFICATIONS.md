# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã

### 1. **Email –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** ‚úÖ –†–µ—à–µ–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞**: SMTP –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, –Ω–æ –∫–æ–¥ email.py —á–∏—Ç–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ `os.getenv()` –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ `load_dotenv()`
- **–†–µ—à–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç .env.local –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ `core.config`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: Email —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º

### 2. **Booking Reminders - –æ–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏** ‚úÖ –†–µ—à–µ–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–∫–Ω–µ ¬±10 –º–∏–Ω—É—Ç –æ—Ç —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- **–ü—Ä–∏–º–µ—Ä**:
  - –ó–∞–ø–∏—Å—å –Ω–∞ 14:00 –∑–∞–≤—Ç—Ä–∞
  - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ "–∑–∞ 24 —á–∞—Å–∞" = –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –≤—á–µ—Ä–∞ –≤ 14:00 ‚ùå
  - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ "–∑–∞ 2 —á–∞—Å–∞" = –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –∑–∞–≤—Ç—Ä–∞ –≤ 12:00 ‚ùå
  - –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è 02:30 = –≤–Ω–µ –æ–∫–Ω–∞ ¬±10 –º–∏–Ω—É—Ç ‚ùå
- **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `test_immediate_notification.py` –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

### 3. **Birthday Notifications - —Ç–∞–±–ª–∏—Ü–∞ users** ‚úÖ –†–µ—à–µ–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞**: `birthday_checker.py` –∏—â–µ—Ç –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `users`, –Ω–æ:
  - `setup_test_notifications.py` —Å–æ–∑–¥–∞–≤–∞–ª –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `employees`
  - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ –∏–º–µ—é—Ç email
- **–†–µ—à–µ–Ω–∏–µ**:
  - –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ `users` —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è
  - –û–±–Ω–æ–≤–ª–µ–Ω email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ê. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ email –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ .env.local
cat .env.local | grep SMTP

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# SMTP_SERVER=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USERNAME=ii3391609@gmail.com
# SMTP_PASSWORD=hkfw qruh hxur ghta
# FROM_EMAIL=ii3391609@gmail.com

# 2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å email
python -c "
import sqlite3
conn = sqlite3.connect('salon_bot.db')
c = conn.cursor()
c.execute('SELECT id, username, email FROM users WHERE role = \"admin\"')
print(c.fetchall())
conn.close()
"
```

### –ë. –¢–µ—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–ø–∏—Å—è—Ö (Booking Reminders)

```bash
# –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–∞ –≤–∞—à–µ–º MacBook (–≥–¥–µ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)!

# 1. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –∫–æ—Ç–æ—Ä–∞—è –¥–∞—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
python scripts/testing/test_immediate_notification.py --email ii3391609@gmail.com

# 2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 3-5 –º–∏–Ω—É—Ç

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
python -m scheduler.booking_reminder_checker

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É ii3391609@gmail.com
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```
2025-11-15 XX:XX:XX - crm - INFO - [booking_reminders] üîî –ù–∞—á–∏–Ω–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–ø–∏—Å—è—Ö...
2025-11-15 XX:XX:XX - crm - INFO - [booking_reminders] üìã –ù–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫: 2
2025-11-15 XX:XX:XX - crm - INFO - [booking_reminders] üìÖ –ù–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–ø–∏—Å–µ–π: 1
2025-11-15 XX:XX:XX - crm - INFO - [booking_reminders] üì® –û—Ç–ø—Ä–∞–≤–ª—è—é –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: 2 hours before –¥–ª—è booking_id=XXX
2025-11-15 XX:XX:XX - crm - INFO - [email] Email sent to ii3391609@gmail.com
2025-11-15 XX:XX:XX - crm - INFO - [booking_reminders] ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π: 1
```

### –í. –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è (Birthday Notifications)

```bash
# –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–∞ –≤–∞—à–µ–º MacBook!

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω
python -c "
from scheduler.birthday_checker import get_upcoming_birthdays
birthdays = get_upcoming_birthdays()
for b in birthdays:
    print(f'–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è: {b[2]} (@{b[1]}) - —á–µ—Ä–µ–∑ {b[5]} –¥–Ω–µ–π')
"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
python -c "
from scheduler.birthday_checker import send_birthday_notifications
send_birthday_notifications()
"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É ii3391609@gmail.com
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- Email –Ω–∞ –∞–¥—Ä–µ—Å ii3391609@gmail.com —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "üéà –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –∑–∞–≤—Ç—Ä–∞!"
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ì. –ì–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç setup_test_notifications.py

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï**: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞, –ø–æ—ç—Ç–æ–º—É:
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ù–ï –ø—Ä–∏–¥—É—Ç —Å—Ä–∞–∑—É
- –û–Ω–∏ –ø—Ä–∏–¥—É—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—É–ø–∏—Ç –≤—Ä–µ–º—è (–∑–∞ 24—á –∏–ª–∏ –∑–∞ 2—á –¥–æ –∑–∞–ø–∏—Å–∏)

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
python scripts/testing/setup_test_notifications.py --email ii3391609@gmail.com
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. Booking Reminders
- **–§–∞–π–ª**: `scheduler/booking_reminder_checker.py`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –¢–∞–±–ª–∏—Ü–∞ `booking_reminder_settings`
- **–õ–æ–≥–∏–∫–∞**: –û–∫–Ω–æ ¬±10 –º–∏–Ω—É—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- **–û—Ç–ø—Ä–∞–≤–∫–∞**: Email —á–µ—Ä–µ–∑ SMTP

### 2. Birthday Notifications (–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
- **–§–∞–π–ª**: `scheduler/birthday_checker.py` ‚Üí `send_birthday_notifications()`
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: –¢–∞–±–ª–∏—Ü–∞ `users` (–ù–ï employees!)
- **–õ–æ–≥–∏–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ days_until (7, 3, 1, 0)
- **–û—Ç–ø—Ä–∞–≤–∫–∞**:
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Å–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
  - Email –≤—Å–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —Å email

### 3. Birthday Congratulations (–ö–ª–∏–µ–Ω—Ç—ã)
- **–§–∞–π–ª**: `scheduler/birthday_checker.py` ‚Üí `send_birthday_congratulations()`
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: –¢–∞–±–ª–∏—Ü–∞ `clients`
- **–õ–æ–≥–∏–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è
- **–û—Ç–ø—Ä–∞–≤–∫–∞**: Instagram —Å–æ–æ–±—â–µ–Ω–∏–µ

## –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

- **Birthday Notifications (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00
- **Birthday Congratulations (–∫–ª–∏–µ–Ω—Ç—ã)**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
- **Booking Reminders**: –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ–∫–Ω–∞ ¬±10 –º–∏–Ω)

## Troubleshooting

### –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç email

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:
   ```bash
   python -c "import os; from dotenv import load_dotenv; load_dotenv('.env.local'); print(f'SMTP: {os.getenv(\"SMTP_SERVER\")}, User: {os.getenv(\"SMTP_USERNAME\")}')"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç**:
   ```bash
   ping smtp.gmail.com
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**:
   ```bash
   tail -f logs/app.log | grep email
   ```

### Booking reminders –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 0 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏**:
   - –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ¬±10 –º–∏–Ω—É—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_immediate_notification.py` –≤–º–µ—Å—Ç–æ `setup_test_notifications.py`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å**:
   ```sql
   SELECT * FROM booking_reminders_sent WHERE booking_id = XXX;
   ```

### Birthday —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É users** (–Ω–µ employees!):
   ```sql
   SELECT id, username, birthday, email FROM users WHERE email IS NOT NULL;
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ days_until**:
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0, 1, 3, –∏–ª–∏ 7
   - –î—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å**:
   ```sql
   SELECT * FROM birthday_notifications WHERE user_id = XXX AND notification_date = 'YYYY-MM-DD';
   ```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ email
python -c "from core.config import *; import os; print(f'SMTP: {os.getenv(\"SMTP_SERVER\")}:{os.getenv(\"SMTP_PORT\")}, User: {os.getenv(\"SMTP_USERNAME\")}')"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
python scripts/database/check_db.py

# –û—á–∏—Å—Ç–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞)
python -c "import sqlite3; conn = sqlite3.connect('salon_bot.db'); conn.execute('DELETE FROM booking_reminders_sent'); conn.execute('DELETE FROM birthday_notifications'); conn.commit(); print('‚úÖ Cleared')"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
python -m scheduler.birthday_checker  # Birthday
python -m scheduler.booking_reminder_checker  # Booking reminders
```
