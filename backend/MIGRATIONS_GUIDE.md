# Beauty CRM - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º

## –û–±–∑–æ—Ä

–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - —ç—Ç–æ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –≤ –ø–∞–ø–∫–µ `db/migrations/` –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ —Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

- **schema/** - –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü (CREATE TABLE, ALTER TABLE)
- **data/** - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (INSERT, UPDATE)
- **maintenance/** - –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π

```bash
cd backend/db/migrations
python3 run_all_migrations.py
```

### –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API

```bash
curl -X POST http://localhost:8000/admin/run-migration/bot_settings
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API:
- `bot_settings`
- `salon_settings`
- `employees`
- `permissions`
- `manager_consultation`

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π

### üìÅ `db/migrations/schema/` - –°—Ö–µ–º–∞ –ë–î

#### `schema/bot/` - –¢–∞–±–ª–∏—Ü—ã –±–æ—Ç–∞

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_bot_modes.py` | –î–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ (consultation, booking, auto) |
| `add_manager_consultation.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ manager_consultation –≤ bot_settings |
| `add_missing_bot_fields.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –≤ bot_settings |
| `add_temperature_field.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ temperature –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AI |
| `add_universal_settings.py` | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ |

#### `schema/employees/` - –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `create_employees.py` | –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É employees |
| `create_positions_table.py` | –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É positions (–¥–æ–ª–∂–Ω–æ—Å—Ç–∏) |
| `link_employees_positions.py` | –°–≤—è–∑—ã–≤–∞–µ—Ç employees –∏ positions (–¥–æ–±–∞–≤–ª—è–µ—Ç position_id) |
| `create_employee_schedules.py` | –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ |
| `create_employee_services.py` | –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —É—Å–ª—É–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ |
| `add_employee_translations.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã –∏–º–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (name_en, name_ar) |
| `add_employee_birthdays.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ birthday –≤ employees |
| `add_employee_id_to_bookings.py` | –î–æ–±–∞–≤–ª—è–µ—Ç employee_id –≤ bookings |
| `add_employee_service_provider.py` | –°–≤—è–∑—ã–≤–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —É—Å–ª—É–≥–∞–º–∏ |
| `add_salary_system.py` | –î–æ–±–∞–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—á–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã |

#### `schema/bookings/` - –ó–∞–ø–∏—Å–∏

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_booking_reminders_system.py` | –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–ø–∏—Å—è—Ö |
| `add_master_field.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ master –≤ bookings |
| `add_service_courses.py` | –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã –∏ –∫—É—Ä—Å—ã —É—Å–ª—É–≥ |
| `add_waitlist.py` | –õ–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è –∑–∞–ø–∏—Å–µ–π |

#### `schema/clients/` - –ö–ª–∏–µ–Ω—Ç—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_client_accounts.py` | –õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| `add_client_interests.py` | –ò–Ω—Ç–µ—Ä–µ—Å—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| `add_client_notes.py` | –ó–∞–º–µ—Ç–∫–∏ –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö |
| `add_client_preferences.py` | –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (–≤—Ä–µ–º—è, –º–∞—Å—Ç–µ—Ä, —É—Å–ª—É–≥–∏) |
| `add_preferred_messenger.py` | –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ |

#### `schema/chat/` - –ß–∞—Ç

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_chat_features.py` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á–∞—Ç–∞ |
| `add_messenger_system.py` | –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ |
| `create_internal_chat.py` | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–∞—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ |

#### `schema/notifications/` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `create_birthday_notifications.py` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ |

#### `schema/permissions/` - –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_permissions_system.py` | –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ |
| `enhance_permissions_system.py` | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ |

#### `schema/salon/` - –°–∞–ª–æ–Ω

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_hours_weekdays_weekends.py` | –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã —Å–∞–ª–æ–Ω–∞ (–±—É–¥–Ω–∏/–≤—ã—Ö–æ–¥–Ω—ã–µ) |

#### `schema/users/` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ CRM

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_birthday_phone_fields.py` | –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `add_email_verification_token.py` | –¢–æ–∫–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email |
| `add_language_column.py` | –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `add_notification_preferences.py` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–∞—Å—Ç–µ—Ä–æ–≤ |
| `add_password_reset_fields.py` | –ü–æ–ª—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è |
| `add_subscription_channels.py` | –ö–∞–Ω–∞–ª—ã –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `add_telegram_chat_id.py` | Telegram chat_id –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `add_telegram_username.py` | Telegram username |
| `add_user_photo.py` | –§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `add_user_position.py` | –î–æ–ª–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `add_user_subscriptions.py` | –ü–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

#### `schema/other/` - –ü—Ä–æ—á–µ–µ

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `add_notes_field.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ notes –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã |
| `create_broadcast_history.py` | –ò—Å—Ç–æ—Ä–∏—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ |
| `create_director_approvals.py` | –°–∏—Å—Ç–µ–º–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ |

---

### üìÅ `db/migrations/data/` - –î–∞–Ω–Ω—ã–µ

#### `data/bot/` - –î–∞–Ω–Ω—ã–µ –±–æ—Ç–∞

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `migrate_bot_settings.py` | –ó–∞–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ |

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ bot_settings —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ AI
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –∏ –ª–∏—á–Ω–æ—Å—Ç—å –±–æ—Ç–∞
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã –∏ –ø—Ä–∞–≤–∏–ª–∞

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏–ª–∏ –¥–ª—è —Å–±—Ä–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞

#### `data/salon/` - –î–∞–Ω–Ω—ã–µ —Å–∞–ª–æ–Ω–∞

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `migrate_salon_settings.py` | –ó–∞–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–ª–æ–Ω–∞ |

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ salon_settings
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∞–ª–æ–Ω–∞, –∞–¥—Ä–µ—Å, –∫–æ–Ω—Ç–∞–∫—Ç—ã
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã
- –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ—Ü—Å–µ—Ç–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ

#### `data/employees/` - –î–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `seed_employees.py` | –°–æ–∑–¥–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ |
| `add_missing_positions.py` | –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ |
| `assign_user_positions.py` | –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º |

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç seed_employees.py:**
- –°–æ–∑–¥–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–æ–ª–∂–Ω–æ—Å—Ç–∏, –∑–∞—Ä–ø–ª–∞—Ç—ã
- –°–≤—è–∑—ã–≤–∞–µ—Ç —Å —É—Å–ª—É–≥–∞–º–∏
- –°–æ–∑–¥–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã employees

#### `data/services/` - –î–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `migrate_services.py` | –ó–∞–ø–æ–ª–Ω—è–µ—Ç —É—Å–ª—É–≥–∏ —Å–∞–ª–æ–Ω–∞ |
| `seed_employee_services.py` | –°–≤—è–∑—ã–≤–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —É—Å–ª—É–≥–∞–º–∏ |

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü services –∏ employees

#### `data/users/` - –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `update_existing_users_roles.py` | –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–æ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

---

### üìÅ `db/migrations/maintenance/` - –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `check_schedules.py` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è |
| `check_translations.py` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã |
| `link_employees_to_services.py` | –°–≤—è–∑—ã–≤–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —É—Å–ª—É–≥–∞–º–∏ |

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å:** –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ employees –∏ positions
```python
from db.migrations.schema.employees.link_employees_positions import link_employees_positions
link_employees_positions()
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ position_id –≤ —Ç–∞–±–ª–∏—Ü—É employees –¥–ª—è —Å–≤—è–∑–∏ —Å positions

### 2. –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
```bash
python3 run_migration_preferred_messenger.py
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –≤—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä (Instagram/Telegram/WhatsApp)

### 3. Telegram chat_id
```bash
python3 run_migration_telegram_chat_id.py
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç Telegram chat ID –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞–º

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```bash
python3 run_migration_notification_preferences.py
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–∞—Å—Ç–µ—Ä–æ–≤ (email, push, telegram)

### 5. –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
```bash
python3 run_migration_client_preferences.py
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ª—é–±–∏–º–æ–µ –≤—Ä–µ–º—è, –ª—é–±–∏–º—ã–π –º–∞—Å—Ç–µ—Ä, –ª—é–±–∏–º—ã–µ —É—Å–ª—É–≥–∏)

### 6. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–æ–≤
```bash
python3 run_migration_master_schedule.py
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–∞–±–æ—á–∏–µ —á–∞—Å—ã –º–∞—Å—Ç–µ—Ä–æ–≤, –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –∑–∞–ø–∏—Å–∏

### 6.1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
```bash
python3 migration_fix_master_schedule_nullable.py
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ (NULL –¥–ª—è start_time/end_time)

### 7. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
```bash
python3 run_migration_loyalty_program.py
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë–∞–ª–ª—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —É—Ä–æ–≤–Ω–∏ (Bronze/Silver/Gold/Platinum), –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π

---

## –ú–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API

–í `main.py` –µ—Å—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/admin/run-migration/{migration_name}` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π:

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

#### `bot_settings`
```bash
curl -X POST http://localhost:8000/admin/run-migration/bot_settings
```
–°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É bot_settings –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

#### `salon_settings`
```bash
curl -X POST http://localhost:8000/admin/run-migration/salon_settings
```
–°–æ–∑–¥–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–ª–æ–Ω–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å, —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã).

#### `employees`
```bash
curl -X POST http://localhost:8000/admin/run-migration/employees
```
–°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É employees –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.

#### `permissions`
```bash
curl -X POST http://localhost:8000/admin/run-migration/permissions
```
–°–æ–∑–¥–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

#### `manager_consultation`
```bash
curl -X POST http://localhost:8000/admin/run-migration/manager_consultation
```
–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ manager_consultation –≤ bot_settings.

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–∏–≥—Ä–∞—Ü–∏–π **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã** - –∏—Ö –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫. –û–Ω–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü/–ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º.

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö. –í—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ:
1. –°–Ω–∞—á–∞–ª–∞ schema –º–∏–≥—Ä–∞—Ü–∏–∏
2. –ü–æ—Ç–æ–º data –º–∏–≥—Ä–∞—Ü–∏–∏
3. –ü–æ—Ç–æ–º maintenance –º–∏–≥—Ä–∞—Ü–∏–∏

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
–í –¥–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–∞—Ç–∞. –î–ª—è –æ—Ç–∫–∞—Ç–∞:
1. –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
2. –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞
3. –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —É–¥–∞–ª–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã/–ø–æ–ª—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
curl http://localhost:8000/admin/diagnostics
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç:
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π
- –°—Ç—Ä—É–∫—Ç—É—Ä—É bot_settings
- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã
cd backend/db/migrations
python3 run_all_migrations.py

# 2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
curl -X POST http://localhost:8000/admin/run-migration/bot_settings
curl -X POST http://localhost:8000/admin/run-migration/salon_settings
curl -X POST http://localhost:8000/admin/run-migration/employees

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl http://localhost:8000/admin/diagnostics
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –ø–∞–ø–∫–µ:
   - `schema/` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - `data/` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   - `maintenance/` –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

2. –°–ª–µ–¥—É–π—Ç–µ —à–∞–±–ª–æ–Ω—É:

```python
#!/usr/bin/env python3
"""
–û–ø–∏—Å–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
"""
import sqlite3
from core.config import DATABASE_NAME

def migrate():
    """–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é"""
    conn = sqlite3.connect(DATABASE_NAME)
    c = conn.cursor()

    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
        c.execute("PRAGMA table_info(table_name)")
        columns = [col[1] for col in c.fetchall()]

        if 'new_column' not in columns:
            # –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
            c.execute("ALTER TABLE table_name ADD COLUMN new_column TEXT")
            conn.commit()
            print("‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞")
            return True
        else:
            print("‚ÑπÔ∏è  –ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞")
            return True

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        conn.rollback()
        return False
    finally:
        conn.close()

if __name__ == "__main__":
    migrate()
```

3. –î–æ–±–∞–≤—å—Ç–µ –≤ `run_all_migrations.py` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

## Troubleshooting

### "table already exists"
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞. –ú–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å.

### "no such column"
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –∫–æ—Ç–æ—Ä–∞—è –¥–æ–±–∞–≤–ª—è–µ—Ç —ç—Ç–æ –ø–æ–ª–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π.

### "database is locked"
–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –º–∏–≥—Ä–∞—Ü–∏–π.

### "constraint failed"
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö. –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–∞ maintenance –º–∏–≥—Ä–∞—Ü–∏—è.

---

## –°–º. —Ç–∞–∫–∂–µ

- **PROJECT_STRUCTURE.md** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- **TESTING_GUIDE.md** - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- `db/__init__.py` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
- `main.py` - endpoints –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-11-16*
