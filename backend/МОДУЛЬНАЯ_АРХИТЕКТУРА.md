# Модульная архитектура Beauty CRM

## Концепция

Проект разделен на независимые модули, каждый из которых может быть включен/выключен через конфигурацию.

## Модули

### 1. **Core** (Обязательный)
- Основная CRM функциональность
- Управление клиентами, записями, услугами
- Аутентификация персонала
- API для работы с данными
- **Зависимости**: нет
- **Конфиг**: `modules.core.enabled = true` (всегда)

### 2. **Public Pages** (Опциональный)
- Публичная страница онлайн-записи
- Личный кабинет клиента
- Регистрация/авторизация клиентов
- API для клиентской части
- **Зависимости**: Core
- **Конфиг**: `modules.public.enabled = true/false`
- **API префикс**: `/public/*`

### 3. **Notifications** (Опциональный)
- Email уведомления
- Telegram уведомления
- SMS уведомления (будущее)
- WhatsApp уведомления (будущее)
- **Зависимости**: Core
- **Конфиг**:
  - `modules.notifications.enabled = true/false`
  - `modules.notifications.email.enabled = true/false`
  - `modules.notifications.telegram.enabled = true/false`

### 4. **Scheduler** (Опциональный)
- Планировщик дней рождения сотрудников
- Планировщик поздравлений клиентов
- Напоминания о записях
- Предложения повторной записи
- **Зависимости**: Core, Notifications
- **Конфиг**: `modules.scheduler.enabled = true/false`

### 5. **Instagram Bot** (Опциональный)
- Instagram интеграция
- Автоматические ответы
- Работа с сообщениями
- **Зависимости**: Core
- **Конфиг**: `modules.instagram.enabled = true/false`

## Структура проекта

```
backend/
├── core/                    # Базовая функциональность
│   ├── config.py           # Конфигурация
│   ├── database.py         # БД
│   └── ...
│
├── modules/                 # Модули приложения
│   ├── __init__.py         # Менеджер модулей
│   ├── base.py             # Базовый класс модуля
│   │
│   ├── public/             # Модуль публичных страниц
│   │   ├── __init__.py
│   │   ├── config.py       # Настройки модуля
│   │   ├── routes.py       # API endpoints
│   │   └── services.py     # Бизнес-логика
│   │
│   ├── notifications/      # Модуль уведомлений
│   │   ├── __init__.py
│   │   ├── config.py
│   │   ├── email.py        # Email уведомления
│   │   ├── telegram.py     # Telegram уведомления
│   │   └── services.py
│   │
│   ├── scheduler/          # Модуль планировщиков
│   │   ├── __init__.py
│   │   ├── config.py
│   │   ├── birthdays.py    # Дни рождения
│   │   └── reminders.py    # Напоминания
│   │
│   └── instagram/          # Модуль Instagram бота
│       ├── __init__.py
│       ├── config.py
│       └── bot.py
│
├── api/                     # API роуты (legacy/core)
├── db/                      # Миграции БД
├── main.py                  # Точка входа
└── modules_config.json      # Конфигурация модулей
```

## Конфигурация модулей (modules_config.json)

```json
{
  "modules": {
    "core": {
      "enabled": true,
      "description": "Core CRM functionality"
    },
    "public": {
      "enabled": false,
      "description": "Public booking pages and client cabinet",
      "settings": {
        "booking_enabled": true,
        "cabinet_enabled": true,
        "registration_enabled": true
      }
    },
    "notifications": {
      "enabled": false,
      "description": "Notification system",
      "channels": {
        "email": {
          "enabled": false,
          "smtp_host": "",
          "smtp_port": 587,
          "smtp_user": "",
          "smtp_password": ""
        },
        "telegram": {
          "enabled": false,
          "bot_token": "",
          "notification_chat_id": ""
        }
      }
    },
    "scheduler": {
      "enabled": false,
      "description": "Background schedulers",
      "jobs": {
        "employee_birthdays": true,
        "client_birthdays": true,
        "booking_reminders": true,
        "rebooking_suggestions": true
      }
    },
    "instagram": {
      "enabled": false,
      "description": "Instagram bot integration"
    }
  }
}
```

## Использование

### Проверка доступности модуля

```python
from modules import is_module_enabled

if is_module_enabled('public'):
    # Подключаем публичные роуты
    from modules.public import router as public_router
    app.include_router(public_router)
```

### Получение настроек модуля

```python
from modules import get_module_config

config = get_module_config('notifications')
if config['channels']['email']['enabled']:
    send_email_notification(...)
```

## Преимущества

1. ✅ **Масштабируемость** - легко добавлять новые модули
2. ✅ **Гибкость** - включать/выключать функциональность без изменения кода
3. ✅ **Независимость** - модули не зависят друг от друга (кроме Core)
4. ✅ **Простота развертывания** - можно использовать только нужные модули
5. ✅ **Тестируемость** - каждый модуль тестируется отдельно

## Миграция

Текущая структура будет постепенно мигрирована:
- `api/public.py` + `api/client_auth.py` → `modules/public/`
- `scheduler/` → `modules/scheduler/`
- `integrations/instagram.py` → `modules/instagram/`
- Новая система уведомлений → `modules/notifications/`
